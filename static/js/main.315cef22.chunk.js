(this["webpackJsonpmls-listing-map"]=this["webpackJsonpmls-listing-map"]||[]).push([[0],{146:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(13),s=n.n(a),o=(n(146),n(210)),c=n(217),u=n(16),l=n(36),d=n(37),h=n(44),p=n(68),f=n(123),v=n(22),b=n(218),m=n(207),g=n(208),j=n(209),x=n(50),O=n(7),y=Object(v.a)((function(){return{buttonsContainer:{padding:"1.5rem",display:"flex",flexDirection:"row",justifyContent:"space-between"}}})),w=function(e){var t=e.title,n=e.isOpen,r=e.confirmButtonLabel,i=e.disableConfirmButton,a=e.hideCancelButton,s=e.children,o=e.onConfirm,c=e.onCancel,u=e.onExited,l=y();return Object(O.jsxs)(b.a,{open:n,maxWidth:!1,onExited:u,children:[Object(O.jsx)(m.a,{children:t}),Object(O.jsx)(g.a,{children:s}),Object(O.jsxs)(j.a,{className:l.buttonsContainer,children:[!a&&Object(O.jsx)(x.a,{onClick:c,variant:"outlined",children:"Cancel"}),Object(O.jsx)(x.a,{onClick:o,variant:"contained",disabled:i,children:r})]})]})},C=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e,r){var i;return Object(l.a)(this,n),(i=t.call(this,e,r)).state={},i}return Object(d.a)(n,[{key:"componentDidCatch",value:function(e){this.setState({errors:[].concat(Object(u.a)(this.state.errors||[]),[e])})}},{key:"resetErrors",value:function(){this.setState({errors:void 0})}},{key:"render",value:function(){var e;return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)(w,{title:"Error",isOpen:null!==this.state&&void 0!==this.state.errors&&this.state.errors.length>0,confirmButtonLabel:"Ok",hideCancelButton:!0,onConfirm:this.resetErrors,onExited:this.resetErrors,children:null===(e=this.state.errors)||void 0===e?void 0:e.map((function(e,t){return Object(O.jsx)(f.a,{children:e},t)}))}),this.props.children]})}}]),n}(r.Component),F=n(6),k=n(213),S=i.a.createContext({errors:null,addError:function(e){},clearAll:function(){}}),I=i.a.createContext({isImporting:!1,selectedListingId:null,listings:null,coordinates:null}),L=n(117),A=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}),N=[{field:"address",headerName:"Address",flex:2,valueGetter:function(e){return e.row.address.street},disableColumnMenu:!0},{field:"unit",headerName:"Unit",flex:.5,valueGetter:function(e){return e.row.address.unit},disableColumnMenu:!0},{field:"type",headerName:"Type",type:"string",flex:.5},{field:"city",headerName:"City",flex:1,valueGetter:function(e){return e.row.address.city}},{field:"price",headerName:"Price",flex:1,type:"number",valueFormatter:function(e){var t,n;return A.format(null!==(t=null===(n=e.value)||void 0===n?void 0:n.valueOf())&&void 0!==t?t:0)}},{field:"bedCount",headerName:"Beds",type:"number",flex:.5},{field:"bathCount",headerName:"Baths",type:"number",flex:.5}],E=function(e){var t,n,r=e.setSelectedListingId,a=i.a.useContext(I);return(null===(t=a.listings)||void 0===t?void 0:t.length)?Object(O.jsx)(L.a,{rows:a.listings,columns:N,autoHeight:!0,disableMultipleSelection:!0,pagination:!0,pageSize:10,rowsPerPageOptions:[10,25,100],onRowSelected:function(e){return r(e.data.id)},selectionModel:[null!==(n=a.selectedListingId)&&void 0!==n?n:NaN]}):Object(O.jsx)(O.Fragment,{})},M=n(27),T=n.n(M),_=n(119),B=n(47),P=n(92),U=function(){var e=Object(B.a)(T.a.mark((function e(t){var n,r,i,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new DOMParser,e.prev=1,r=n.parseFromString(t,"text/html"),i=r.querySelectorAll("tr[data-ListNo]"),a=[],i.forEach(function(){var e=Object(B.a)(T.a.mark((function e(t){var n,r,i,s,o,c,u,l,d,h,p,f;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:d=parseInt(null!==(n=t.getAttribute("data-ListNo"))&&void 0!==n?n:"0"),h=D(null!==(r=null===(i=t.children.item(11))||void 0===i?void 0:i.textContent)&&void 0!==r?r:""),p=null!==(s=null===(o=t.children)||void 0===o||null===(c=o.item(9))||void 0===c?void 0:c.textContent)&&void 0!==s?s:"",f=q(p),a.push({id:d,address:f,type:h.type,price:z(null!==(u=null===(l=t.children.item(13))||void 0===l?void 0:l.textContent)&&void 0!==u?u:"0"),bedCount:h.bedCount,bathCount:h.bathCount});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.abrupt("return",Promise.resolve({success:!0,data:a}));case 9:return e.prev=9,e.t0=e.catch(1),e.abrupt("return",{success:!1,error:e.t0.toString()});case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),D=function(e){var t,n,r,i,a=Object(P.a)(/([0-9])[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]bed,[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]([0-9])f[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]([0-9])h[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]bath[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF](.*)/,{bed:1,bathfull:2,bathhalf:3,type:4}).exec(e),s=null===a||void 0===a||null===(t=a.groups.type)||void 0===t?void 0:t.replace(/\sx[\d]+.*/,"");return{type:null!==s&&void 0!==s?s:"Unknown",bedCount:parseInt(null!==(n=null===a||void 0===a?void 0:a.groups.bed)&&void 0!==n?n:"0"),bathCount:parseInt(null!==(r=null===a||void 0===a?void 0:a.groups.bathfull)&&void 0!==r?r:"0")+.5*parseInt(null!==(i=null===a||void 0===a?void 0:a.groups.bathhalf)&&void 0!==i?i:"0")}},q=function(e){try{var t=e.match(/.*MA.*/);if(!(null===t||void 0===t?void 0:t.length)||1!==t.length)throw new Error("MA not found");var n=Object(P.a)(/(.*)[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]([A-Za-z]+(?:[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF][A-Za-z]+)*), MA/,{street:1,city:2}).exec(t[0]);if(!(null===n||void 0===n?void 0:n.groups))throw new Error("Could not split street/city");var r=n.groups.street.trim(),i=r.indexOf("U:"),a=i>=0?r.slice(i+2,r.length).trim():null;return{street:r=i>=0?r.slice(0,i-1):r,unit:a,city:n.groups.city,state:"MA"}}catch(s){return{street:s.toString(),city:"nowhere",state:"MA"}}},z=function(e){try{var t=e.match(/(?:\$)([\d,]+)/);if(!(null===t||void 0===t?void 0:t.length)||2!==t.length)throw new Error("Invalid price format: ".concat(e));return parseInt(t[1].replace(",",""))}catch(n){return 0}},G=n(120),J=n.n(G),W=new(function(){function e(t){Object(l.a)(this,e),this._delay=void 0,this._queue=void 0,this._isTicking=void 0,this._delay=t,this._queue=[],this._isTicking=!1}return Object(d.a)(e,[{key:"waitNext",value:function(){var e=this,t=new Promise((function(t,n){return e._queue.push({resolve:t,reject:n})}));return this._isTicking||this.startTick(),t}},{key:"startTick",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isTicking&&!e||(this._isTicking=!0,setTimeout(this.pop.bind(this),this._delay))}},{key:"pop",value:function(){var e=this._queue.shift();if(e){try{e.resolve()}catch(t){console.log("DelayQueue callback threw error that was ignored: ".concat(t))}this._queue.length?this.startTick(!0):this._isTicking=!1}}}]),e}())(1500),V=function(){var e=Object(B.a)(T.a.mark((function e(t,n){var r,i,a,s,o,c,u,l;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,(r=localStorage.getItem(t.toString()))||(r=localStorage.getItem(n.toLocaleUpperCase())),!r){e.next=7;break}return(i=JSON.parse(r)).id!==t&&(i.id=t,a=2*Math.random()*Math.PI,i.latitude=i.latitude+5e-5*Math.sin(a),i.longitude=i.longitude+5e-5*Math.cos(a)),e.abrupt("return",{success:!0,data:i});case 7:return e.next=9,W.waitNext();case 9:return s={q:n,format:"jsonv2",limit:1,addressdetails:1,countrycodes:"us"},e.next=12,fetch("https://nominatim.openstreetmap.org/search?".concat(J.a.encode(s)));case 12:if((o=e.sent).ok){e.next=15;break}return e.abrupt("return",{success:!1,error:"Nominatim failed with status: ".concat(o.status)});case 15:return e.next=17,o.json();case 17:if((c=e.sent)&&c.length&&1===c.length){e.next=20;break}return e.abrupt("return",{success:!1,error:"Nominatim returned invalid result: ".concat(c)});case 20:return u={id:t,latitude:parseFloat(c[0].lat),longitude:parseFloat(c[0].lon)},l=JSON.stringify(u),localStorage.setItem(t.toString(),l),localStorage.setItem(n.toLocaleUpperCase(),l),e.abrupt("return",{success:!0,data:u});case 27:return e.prev=27,e.t0=e.catch(0),e.abrupt("return",{success:!1,error:e.t0.toString()});case 30:case"end":return e.stop()}}),e,null,[[0,27]])})));return function(t,n){return e.apply(this,arguments)}}(),H=n(100),R=Object(v.a)((function(){return{sourceInput:{width:"80vw"}}})),Z=function(e){var t=e.isOpen,n=e.setIsImporting,r=e.setListings,a=e.setCoordinates,s=e.close,o=i.a.useState(),c=Object(F.a)(o,2),l=c[0],d=c[1],h=i.a.useContext(S),p=i.a.useContext(I),f=R(),v=function(){var e=Object(B.a)(T.a.mark((function e(){var t,i,o,c,d,f,v,b,m,g,j,x,O;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l){e.next=3;break}return h.addError("Please enter source information."),e.abrupt("return");case 3:return n(!0),e.next=6,U(l);case 6:if((d=e.sent).success&&(null===(t=d.data)||void 0===t?void 0:t.length)){e.next=10;break}return h.addError("Tell Jeff the parse isn't working: ".concat(null===(f=d.error)||void 0===f?void 0:f.toString())),e.abrupt("return");case 10:v=d.data,b=new Set(null===(i=p.listings)||void 0===i?void 0:i.map((function(e){return e.id}))),v=v.filter((function(e){return!b.has(e.id)&&(b.add(e.id),!0)})),s(),r([].concat(Object(u.a)(null!==(o=p.listings)&&void 0!==o?o:[]),Object(u.a)(v))),m=null!==(c=p.coordinates)&&void 0!==c?c:[],g=Object(_.a)(v),e.prev=17,g.s();case 19:if((j=g.n()).done){e.next=31;break}return x=j.value,e.next=23,V(x.id,"".concat(x.address.street,", ").concat(x.address.city,", ").concat(x.address.state));case 23:if((O=e.sent).success&&O.data){e.next=27;break}return console.log("Failed to get coordinates for ".concat(x.address.street,": ").concat(O.error)),e.abrupt("continue",29);case 27:m.push(O.data),a(Object(u.a)(m));case 29:e.next=19;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(17),g.e(e.t0);case 36:return e.prev=36,g.f(),e.finish(36);case 39:n(!1);case 40:case"end":return e.stop()}}),e,null,[[17,33,36,39]])})));return function(){return e.apply(this,arguments)}}();return Object(O.jsx)(w,{title:"Input MLS Page",isOpen:t,onConfirm:v,confirmButtonLabel:"Import",onCancel:s,children:Object(O.jsx)(H.a,{className:f.sourceInput,multiline:!0,fullWidth:!0,rows:10,rowsMax:30,placeholder:"Paste page source here...",variant:"outlined",onChange:function(e){return d(e.currentTarget.value)}})})},Q=Object(v.a)((function(){return{listingView:{width:"80vw",height:"80vh"}}})),$=function(e){var t,n,r,a,s=e.isOpen,o=e.close,c=i.a.useContext(I),u=Q();return Object(O.jsx)(w,{title:null!==(t=null===(n=c.listings)||void 0===n||null===(r=n.find((function(e){return e.id===c.selectedListingId})))||void 0===r?void 0:r.address.street)&&void 0!==t?t:"Invalid Listing Selected",isOpen:s&&!!(null===(a=c.listings)||void 0===a?void 0:a.length),hideCancelButton:!0,onConfirm:o,confirmButtonLabel:"Close",children:c.selectedListingId&&Object(O.jsx)("iframe",{className:u.listingView,title:c.selectedListingId.toString(),src:"https://vow.mlspin.com/VOW/listingviews/GetListing?rm=1&vf=2&summ=false&o=2&od=1&f=0&ps=0&offs=0&sel=".concat(c.selectedListingId,"&sp=false&cb=16190256")})})},K=n(214),X=n(221),Y=n(215),ee=n(216),te=Object(v.a)({map:{width:"100%",height:"50vh",margin:"1rem 0"},listingType:{textTransform:"capitalize"}}),ne=function(e){var t,n=e.setSelectedListingId,r=(e.showListing,i.a.useContext(I)),a=te();return Object(O.jsx)(k.a,{item:!0,children:Object(O.jsxs)(K.a,{center:[42.41,-71.15],zoom:11.6,scrollWheelZoom:!0,className:a.map,children:[Object(O.jsx)(X.a,{attribution:'\xa9 <a href="http://osm.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),null===(t=r.coordinates)||void 0===t?void 0:t.reduce((function(e,t){var i,s=null===(i=r.listings)||void 0===i?void 0:i.find((function(e){return e.id===t.id}));return s?(e.push(Object(O.jsx)(Y.a,{position:[t.latitude,t.longitude],eventHandlers:{click:function(e){return n(t.id)}},children:Object(O.jsx)(ee.a,{children:Object(O.jsxs)(k.a,{container:!0,direction:"column",alignItems:"center",children:[Object(O.jsx)(k.a,{item:!0,children:Object(O.jsx)(f.a,{component:"b",children:s.address.street})}),Object(O.jsx)(k.a,{item:!0,children:Object(O.jsx)(f.a,{component:"b",children:s.address.unit?"Unit: ".concat(s.address.unit):""})}),Object(O.jsx)(k.a,{item:!0,children:Object(O.jsx)(f.a,{component:"b",className:a.listingType,children:s.type})}),Object(O.jsx)(x.a,{variant:"contained",color:"primary",onClick:function(){return function(e){var t=window.open("https://vow.mlspin.com/VOW/listingviews/GetListing?rm=1&vf=2&summ=false&o=2&od=1&f=0&ps=0&offs=0&sel=".concat(e,"&sp=false&cb=16190256"),"_blank","noopener,noreferrer");t&&(t.opener=null)}(t.id)},children:"Open Listing"})]})})},t.id)),e):e}),[])]})})},re=Object(v.a)({mainContainer:{margin:"0 5rem",width:"auto"},buttonContainer:{margin:"1rem 0"}}),ie=function(){var e=i.a.useState(!1),t=Object(F.a)(e,2),n=t[0],r=t[1],a=i.a.useState(!1),s=Object(F.a)(a,2),o=s[0],c=s[1],l=i.a.useState(null),d=Object(F.a)(l,2),h=d[0],p=d[1],f=i.a.useState(null),v=Object(F.a)(f,2),b=v[0],m=v[1],g=i.a.useState(null),j=Object(F.a)(g,2),y=j[0],w=j[1],C=i.a.useState(null),L=Object(F.a)(C,2),A=L[0],N=L[1],M=i.a.useState(!0),T=Object(F.a)(M,2),_=T[0],B=T[1],P=re();return Object(O.jsx)(I.Provider,{value:{isImporting:n,selectedListingId:h,listings:b,coordinates:y},children:Object(O.jsx)(S.Provider,{value:{errors:A,addError:function(e){N([].concat(Object(u.a)(null!==A&&void 0!==A?A:[]),[e]))},clearAll:function(){return N(null)}},children:Object(O.jsxs)(k.a,{container:!0,direction:"column",className:P.mainContainer,children:[Object(O.jsx)(k.a,{container:!0,item:!0,direction:"row",justify:"space-evenly",alignItems:"center",className:P.buttonContainer,children:Object(O.jsx)(x.a,{variant:"contained",onClick:function(){return B(!0)},children:"Import"})}),Object(O.jsx)(Z,{isOpen:_,setIsImporting:r,setListings:m,setCoordinates:w,close:function(){return B(!1)}}),Object(O.jsx)(ne,{setSelectedListingId:p,showListing:function(){return c(!0)}}),Object(O.jsx)(E,{setSelectedListingId:p}),Object(O.jsx)($,{isOpen:o,close:function(){return c(!1)}})]})})})},ae=n(53),se=Object(ae.a)({palette:{type:"dark"},shape:{borderRadius:1},overrides:{MuiCssBaseline:{"@global":{body:{margin:0,fontFamily:["-apple-system","BlinkMacSystemFont","Segoe UI","Roboto","Oxygen","Ubuntu","Cantarell","Fira Sans","Droid Sans","Helvetica Neue","sans-serif"].join("."),height:"100%"},html:{height:"100%"}}}}}),oe=function(){return Object(O.jsxs)(o.a,{theme:se,children:[Object(O.jsx)(c.a,{}),Object(O.jsx)(C,{children:Object(O.jsx)(ie,{})})]})};s.a.render(Object(O.jsx)(i.a.StrictMode,{children:Object(O.jsx)(oe,{})}),document.getElementById("root"))}},[[158,1,2]]]);
//# sourceMappingURL=main.315cef22.chunk.js.map